# Requirements Document

## Project Description (Input)
求人情報は消す。
 レビューを載せる。　レビューとは、会社に対する元従業員・現従業員からのレビューを載せる。
 1件のレビューには、
 1) 項目: 推薦度合
   - 他の外国人に就業を推薦したい会社ですか？
 2) 項目: 外国人の受け入れ制度
   - 外国人の受け入れ制度が出来ていますか？
   - 外国人の就労Visa手続きが整えられていますか？
   - 言語サポートは用意されていますか？ (業務に必要な資料の多言語化が行われているか？　 日本語学習支援制度が整備されているか？ 難解な書類や業務などに通訳や翻訳支援が適切に提供されているか？)
 3) 項目: 会社風土
 　　- 会社方針は明確ですか？
   - 会社方針と実際には乖離があるか？
   - 文化的多様性を尊重する組織文化があるか？  ( 異文化理解のための研修が実施されているか？ 宗教的配慮や文化的慣習への理解があるか？)
   - 外国人従業員の考えを受け入れ可能な風土ですか？
 4) 項目: 社員との関係性
   - 上司・部下とも尊敬の念を持って人間関係が構築できる風土ですか？
   - 日本人社員との交流促進の仕組みがあるか？
   - 既存の外国人従業員から教えてもらえる機会があるか？
 5) 項目: 成果・評価制度
 　　- 外国人従業員の成果が認められる制度や環境が整っているか？
 6) 項目: 昇進・昇給・待遇
 　　- 昇進・昇給機会は与えられているか？
   - 昇進・昇給の合理的な理由が提示されるか？
　　　- 同一労働同一賃金が実現されているか？
   - 適切な評価のもと待遇が提示されているか？
 を、コメントと、5点満点で1-5点（小数点なし）で選択できること。点数は5点満点or"回答しない"を選択できること。
 ノーコメントも選択出来ること。
 1件のレビューには、レビュー平均点を計算して載せる。
 レビュー平均点の計算式は、(回答で点数が入っている項目の点数の合計値)÷(回答で点数が入っている項目数)とする。
  例えば、1) 3点、2)回答しない、3) 2点、4~7)回答しない の場合は、(3+2)÷(2)=2.5となる。　レビュー平均点は、
  小数点1位までに四捨五入で計算し、レコードに保持する。
　レビュー平均点は、htmlでの表示名は、"レビュー点数"とする。
 htmlのurlは、 /review とする。
 会社1件に対し、レビューは投稿者数N件をデータ保持することができるようにする。　同じUser は、同一の会社に対し、1年以内は自身の投稿したレビューは更新は出来るが、2件以上は投稿できない。　同じUser は、同一の会社に対し、1年に1件ずつ登録できる。
　会社1件のレビュー平均点も計算する。 会社1件のレビュー平均点は、全項目平均と項目別平均がある。
 レビューが投稿される度に、会社1件についての全件のレビュー平均点の平均値(=全項目平均)とする。
 　例えば、会社1件について、 レビューが3件ありそれぞれ 2.5, 3.5, 3.0 のレビュー平均点であれば、会社1件のレビュー平均点は、(2.5+3.5+3.0)÷(3件)=3.0 となる。 会社1件のレビュー平均点も、小数点1位までに四捨五入で計算し、companyレコードに保持する。
 レビューが投稿される度に、会社1件についての項目別平均が再計算される。
 レビューも、企業名とLocationと平均点で検索できるようにする。

## Requirements

### 1. 機能要件

#### 1.1 レビュー投稿機能

##### 1.1.1 評価項目構造
- **6つの評価カテゴリー**
  1. **推薦度合い**
     - 質問: 他の外国人に就業を推薦したい会社ですか？
     - 評価: 1-5点または「回答しない」
     - コメント: 任意（ノーコメント選択可）

  2. **外国人の受け入れ制度**
     - 質問項目:
       - 外国人の受け入れ制度が出来ていますか？
       - 外国人の就労Visa手続きが整えられていますか？
       - 言語サポートは用意されていますか？
     - 評価: 1-5点または「回答しない」
     - コメント: 任意（ノーコメント選択可）

  3. **会社風土**
     - 質問項目:
       - 会社方針は明確ですか？
       - 会社方針と実際には乖離があるか？
       - 文化的多様性を尊重する組織文化があるか？
       - 外国人従業員の考えを受け入れ可能な風土ですか？
     - 評価: 1-5点または「回答しない」
     - コメント: 任意（ノーコメント選択可）

  4. **社員との関係性**
     - 質問項目:
       - 上司・部下とも尊敬の念を持って人間関係が構築できる風土ですか？
       - 日本人社員との交流促進の仕組みがあるか？
       - 既存の外国人従業員から教えてもらえる機会があるか？
     - 評価: 1-5点または「回答しない」
     - コメント: 任意（ノーコメント選択可）

  5. **成果・評価制度**
     - 質問: 外国人従業員の成果が認められる制度や環境が整っているか？
     - 評価: 1-5点または「回答しない」
     - コメント: 任意（ノーコメント選択可）

  6. **昇進・昇給・待遇**
     - 質問項目:
       - 昇進・昇給機会は与えられているか？
       - 昇進・昇給の合理的な理由が提示されるか？
       - 同一労働同一賃金が実現されているか？
       - 適切な評価のもと待遇が提示されているか？
     - 評価: 1-5点または「回答しない」
     - コメント: 任意（ノーコメント選択可）

##### 1.1.2 評価方式
- **点数選択**: 1-5点（整数のみ、小数点なし）
- **未回答オプション**: 「回答しない」を選択可能
- **コメント**: 各項目に任意でコメント追加可能
- **ノーコメント選択**: コメントなしも選択可能

##### 1.1.3 投稿制限
- **同一会社への投稿制限**:
  - 1年以内: 既存レビューの更新のみ可能（新規投稿不可）
  - 1年経過後: 新規レビューとして投稿可能
  - ユーザーごとに会社あたり年1件まで
- **ユーザー認証**: ログイン必須
- **投稿者情報**: 現従業員/元従業員の区別

#### 1.2 レビュー平均点計算

##### 1.2.1 個別レビュー平均点
- **計算式**: (回答した項目の点数合計) ÷ (回答した項目数)
- **小数処理**: 小数第1位まで（四捨五入）
- **保存**: レビューレコードに保持
- **表示名**: "レビュー点数"

##### 1.2.2 会社別平均点
- **全項目平均**:
  - 計算式: (全レビューの個別平均点合計) ÷ (レビュー数)
  - 小数処理: 小数第1位まで（四捨五入）
  - 更新タイミング: レビュー投稿・更新時に再計算
  - 保存: companyレコードに保持

- **項目別平均**:
  - 各評価カテゴリーごとの平均点を算出
  - 計算式: (該当項目の全回答点数合計) ÷ (該当項目の回答数)
  - 小数処理: 小数第1位まで（四捨五入）
  - 更新タイミング: レビュー投稿・更新時に再計算

#### 1.3 検索機能

##### 1.3.1 検索条件
- **企業名**: 部分一致検索
- **Location**: 完全一致または部分一致
- **平均点**: 範囲指定（例: 3.0以上）
- **複合検索**: 上記条件の AND 検索

##### 1.3.2 検索結果表示
- **ソート順**:
  - 平均点の高い順
  - レビュー数の多い順
  - 更新日時の新しい順
- **ページネーション**: 実装必須
- **検索結果情報**:
  - 会社名
  - Location
  - 全項目平均点
  - レビュー数

#### 1.4 レビュー表示機能

##### 1.4.1 会社詳細ページ
- **サマリー情報**:
  - 全項目平均点
  - 項目別平均点
  - 総レビュー数
  - 評価分布グラフ

##### 1.4.2 個別レビュー表示
- **表示項目**:
  - 投稿者属性（現/元従業員）
  - 投稿日時
  - 個別レビュー平均点
  - 各項目の評価とコメント
- **表示順**:
  - 新着順（デフォルト）
  - 評価点順
  - 参考になった順

### 2. 非機能要件

#### 2.1 パフォーマンス要件
- **ページ読み込み**: 3秒以内
- **検索レスポンス**: 2秒以内
- **平均点再計算**: バックグラウンド処理推奨
- **同時アクセス**: 100ユーザー以上対応

#### 2.2 セキュリティ要件
- **認証**: ユーザーログイン必須
- **データ保護**: 個人情報の暗号化
- **CSRF対策**: トークン実装
- **XSS対策**: 入力値サニタイズ
- **SQL Injection対策**: プリペアドステートメント使用

#### 2.3 ユーザビリティ要件
- **レスポンシブデザイン**: モバイル/タブレット対応
- **多言語対応**: 最低限日本語・英語
- **アクセシビリティ**: WCAG 2.1 Level AA準拠
- **エラーハンドリング**: ユーザーフレンドリーなエラーメッセージ

#### 2.4 データ要件
- **データベース設計**:
  - reviewsテーブル: レビュー情報
  - review_ratingsテーブル: 項目別評価
  - companiesテーブル: 平均点フィールド追加
- **バックアップ**: 日次自動バックアップ
- **データ保持期間**: 無期限（削除は論理削除）

### 3. 画面要件

#### 3.1 レビュー一覧画面（/review）
- **URL**: `/review`
- **コンポーネント**:
  - 検索フォーム
  - 検索結果リスト
  - ページネーション
  - ソート選択

#### 3.2 レビュー投稿画面
- **コンポーネント**:
  - 会社選択/検索
  - 6カテゴリー評価フォーム
  - コメント入力欄
  - プレビュー機能
  - 送信ボタン

#### 3.3 レビュー編集画面
- **条件**: 1年以内の自己投稿のみ
- **コンポーネント**:
  - 既存評価の表示
  - 編集フォーム
  - 更新/キャンセルボタン

### 4. 制約事項

#### 4.1 技術制約
- **既存システムとの互換性**: 現行の会社データベース構造を維持
- **フレームワーク**: 既存プロジェクトのスタックに準拠
- **ブラウザサポート**: Chrome, Firefox, Safari, Edge最新版

#### 4.2 ビジネス制約
- **リリース時期**: 段階的リリース推奨
- **データ移行**: 求人情報削除とレビュー機能への切り替え
- **コンプライアンス**: 個人情報保護法準拠

### 5. 受け入れ基準

#### 5.1 機能テスト
- [ ] 6カテゴリーの評価が正しく保存される
- [ ] レビュー平均点が正確に計算される
- [ ] 会社別平均点が正確に更新される
- [ ] 検索機能が正常に動作する
- [ ] 1年以内の重複投稿が制限される

#### 5.2 非機能テスト
- [ ] ページ読み込みが3秒以内
- [ ] 100ユーザー同時アクセスで正常動作
- [ ] モバイル端末で正常表示
- [ ] セキュリティ脆弱性がない

### 6. 用語定義

| 用語 | 定義 |
|------|------|
| レビュー平均点 | 1件のレビューにおける回答項目の平均値 |
| 全項目平均 | 会社に対する全レビューの平均点の平均値 |
| 項目別平均 | 特定評価カテゴリーに対する全回答の平均値 |
| 評価カテゴリー | 6つの大分類（推薦度合い等） |
| 回答しない | 評価を行わない選択肢 |

### 7. リスクと対策

| リスク | 影響度 | 発生可能性 | 対策 |
|--------|--------|------------|------|
| 不適切なレビュー投稿 | 高 | 中 | モデレーション機能の実装 |
| 平均点計算の負荷 | 中 | 高 | キャッシュとバックグラウンド処理 |
| 個人情報漏洩 | 高 | 低 | セキュリティ監査と暗号化 |
| システム移行の混乱 | 中 | 中 | 段階的移行と並行稼働期間 |
