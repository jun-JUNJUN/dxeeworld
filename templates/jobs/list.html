{% extends "../base.html" %}

{% block title %}{{ page_title }} - Startup Platform: Dxee{% end %}

{% block head %}
<style>
.jobs-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.page-header {
    margin-bottom: 30px;
}

.page-header h1 {
    font-size: 2rem;
    color: #2c3e50;
    margin-bottom: 10px;
}

.jobs-stats {
    color: #7f8c8d;
    font-size: 0.9rem;
}

/* æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.search-section {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 30px;
    border: 1px solid #e9ecef;
}

.search-form {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
}

.search-group {
    display: flex;
    flex-direction: column;
}

.search-group label {
    font-weight: 500;
    margin-bottom: 5px;
    color: #495057;
    font-size: 0.9rem;
}

.search-group input,
.search-group select {
    padding: 8px 12px;
    border: 1px solid #ced4da;
    border-radius: 4px;
    font-size: 0.9rem;
    background: white;
}

.search-group input:focus,
.search-group select:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
}

.search-actions {
    display: flex;
    gap: 10px;
    align-items: end;
}

/* æ±‚äººä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« */
.jobs-table-wrapper {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    overflow: hidden;
}

.jobs-table {
    width: 100%;
    border-collapse: collapse;
}

.jobs-table th {
    background: #f8f9fa;
    padding: 15px 12px;
    text-align: left;
    font-weight: 600;
    color: #495057;
    border-bottom: 2px solid #dee2e6;
    font-size: 0.9rem;
}

.jobs-table td {
    padding: 12px;
    border-bottom: 1px solid #dee2e6;
    vertical-align: top;
}

.jobs-table tbody tr:hover {
    background: #f8f9fa;
}

.job-title {
    font-weight: 600;
    color: #007bff;
    text-decoration: none;
    font-size: 1.1rem;
}

.job-title:hover {
    text-decoration: underline;
}

.company-name {
    color: #6c757d;
    font-size: 0.9rem;
    margin-bottom: 5px;
}

.job-description {
    color: #6c757d;
    font-size: 0.85rem;
    max-width: 300px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.job-badges {
    display: flex;
    gap: 5px;
    margin-bottom: 8px;
}

.job-badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 500;
}

.job-type-badge {
    background: #e3f2fd;
    color: #1565c0;
}

.experience-badge {
    background: #f3e5f5;
    color: #7b1fa2;
}

.remote-badge {
    background: #e8f5e8;
    color: #2e7d32;
}

/* ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ */
.pagination-section {
    margin-top: 30px;
    display: flex;
    justify-content: between;
    align-items: center;
    flex-wrap: wrap;
    gap: 20px;
}

.pagination-info {
    color: #6c757d;
    font-size: 0.9rem;
}

.pagination {
    display: flex;
    gap: 5px;
    align-items: center;
}

.pagination .btn {
    min-width: 40px;
    text-align: center;
    padding: 8px 12px;
    border-radius: 4px;
    text-decoration: none;
    color: #6c757d;
    border: 1px solid #dee2e6;
    background: white;
}

.pagination .btn.active {
    background: #007bff;
    color: white;
    border-color: #007bff;
}

.pagination .btn:hover:not(.active):not(:disabled) {
    background: #f8f9fa;
    color: #495057;
}

.pagination .btn:disabled {
    background: #e9ecef;
    color: #6c757d;
    cursor: not-allowed;
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ */
@media (max-width: 768px) {
    .jobs-container {
        padding: 10px;
    }

    .search-form {
        grid-template-columns: 1fr;
    }

    .search-actions {
        justify-content: center;
    }

    .jobs-table-wrapper {
        overflow-x: auto;
    }

    .jobs-table {
        min-width: 800px;
    }

    .pagination-section {
        flex-direction: column;
        text-align: center;
    }

    .job-badges {
        flex-wrap: wrap;
    }
}

.no-results {
    text-align: center;
    padding: 40px 20px;
    color: #6c757d;
}

.no-results-icon {
    font-size: 3rem;
    margin-bottom: 15px;
}
</style>
{% end %}

{% block content %}
<div class="jobs-container">
    <!-- ãƒšãƒ¼ã‚¸ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="page-header">
        <h1>{{ page_title }}</h1>
        <div class="jobs-stats">
            å…¨{{ total_jobs }}ä»¶ã®æ±‚äººæƒ…å ±
            {% if filters %}
            ï¼ˆæ¤œç´¢æ¡ä»¶é©ç”¨ä¸­ï¼‰
            {% end %}
        </div>
    </div>

    <!-- æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
    <div class="search-section">
        <form method="GET" action="/jobs" id="search-form">
            <div class="search-form">
                <!-- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ -->
                <div class="search-group">
                    <label for="keyword">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</label>
                    <input type="text" name="keyword" id="keyword" placeholder="è·ç¨®ã€ä¼šç¤¾åã€ã‚¹ã‚­ãƒ«ãªã©"
                           value="{{ filters.get('keyword', '') }}">
                </div>

                <!-- å‹¤å‹™åœ° -->
                <div class="search-group">
                    <label for="location">å‹¤å‹™åœ°</label>
                    <input type="text" name="location" id="location" placeholder="æ±äº¬ã€å¤§é˜ªãªã©"
                           value="{{ filters.get('location', '') }}">
                </div>

                <!-- é›‡ç”¨å½¢æ…‹ -->
                <div class="search-group">
                    <label for="job_type">é›‡ç”¨å½¢æ…‹</label>
                    <select name="job_type" id="job_type">
                        <option value="">ã™ã¹ã¦</option>
                        <option value="full_time" {% if filters.get('job_type') == 'full_time' %}selected{% end %}>æ­£ç¤¾å“¡</option>
                        <option value="part_time" {% if filters.get('job_type') == 'part_time' %}selected{% end %}>ãƒ‘ãƒ¼ãƒˆãƒ»ã‚¢ãƒ«ãƒã‚¤ãƒˆ</option>
                        <option value="contract" {% if filters.get('job_type') == 'contract' %}selected{% end %}>å¥‘ç´„ç¤¾å“¡</option>
                        <option value="internship" {% if filters.get('job_type') == 'internship' %}selected{% end %}>ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³</option>
                        <option value="other" {% if filters.get('job_type') == 'other' %}selected{% end %}>ãã®ä»–</option>
                    </select>
                </div>

                <!-- çµŒé¨“ãƒ¬ãƒ™ãƒ« -->
                <div class="search-group">
                    <label for="experience_level">çµŒé¨“ãƒ¬ãƒ™ãƒ«</label>
                    <select name="experience_level" id="experience_level">
                        <option value="">ã™ã¹ã¦</option>
                        <option value="entry" {% if filters.get('experience_level') == 'entry' %}selected{% end %}>æ–°å’ãƒ»æœªçµŒé¨“</option>
                        <option value="junior" {% if filters.get('experience_level') == 'junior' %}selected{% end %}>ã‚¸ãƒ¥ãƒ‹ã‚¢</option>
                        <option value="mid" {% if filters.get('experience_level') == 'mid' %}selected{% end %}>ãƒŸãƒ‰ãƒ«</option>
                        <option value="senior" {% if filters.get('experience_level') == 'senior' %}selected{% end %}>ã‚·ãƒ‹ã‚¢</option>
                        <option value="lead" {% if filters.get('experience_level') == 'lead' %}selected{% end %}>ãƒªãƒ¼ãƒ‰</option>
                        <option value="executive" {% if filters.get('experience_level') == 'executive' %}selected{% end %}>ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–</option>
                    </select>
                </div>

                <!-- ãƒªãƒ¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯ -->
                <div class="search-group">
                    <label for="remote_work">ãƒªãƒ¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯</label>
                    <select name="remote_work" id="remote_work">
                        <option value="">ã™ã¹ã¦</option>
                        <option value="true" {% if filters.get('remote_work') == True %}selected{% end %}>å¯</option>
                        <option value="false" {% if filters.get('remote_work') == False %}selected{% end %}>ä¸å¯</option>
                    </select>
                </div>
            </div>

            <div class="search-actions">
                <button type="submit" class="btn btn-primary">æ¤œç´¢</button>
                <a href="/jobs" class="btn btn-secondary">æ¡ä»¶ã‚’ã‚¯ãƒªã‚¢</a>
            </div>
        </form>
    </div>

    <!-- æ±‚äººä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« -->
    {% if jobs %}
    <div class="jobs-table-wrapper">
        <table class="jobs-table">
            <thead>
                <tr>
                    <th>æ±‚äººæƒ…å ±</th>
                    <th>ä¼šç¤¾å</th>
                    <th>é›‡ç”¨å½¢æ…‹</th>
                    <th>çµŒé¨“ãƒ¬ãƒ™ãƒ«</th>
                    <th>å‹¤å‹™åœ°</th>
                    <th>çµ¦ä¸</th>
                    <th>æ²è¼‰æ—¥</th>
                </tr>
            </thead>
            <tbody>
                {% for job in jobs %}
                <tr>
                    <td>
                        <div class="job-badges">
                            <span class="job-badge job-type-badge">{{ job['job_type'] }}</span>
                            {% if job['remote_work'] %}
                            <span class="job-badge remote-badge">ãƒªãƒ¢ãƒ¼ãƒˆå¯</span>
                            {% end %}
                        </div>
                        <a href="#" class="job-title">{{ job['title'] }}</a>
                        {% if job['description'] %}
                        <div class="job-description" title="{{ job['description'] }}">
                            {{ job['description'] }}
                        </div>
                        {% end %}
                    </td>
                    <td>
                        <div class="company-name">{{ job['company_name'] }}</div>
                    </td>
                    <td>
                        <span class="job-badge experience-badge">{{ job['experience_level'] }}</span>
                    </td>
                    <td>{{ job['location'] }}</td>
                    <td>
                        {% if job['salary_range'] %}
                        {{ "{:,}".format(job['salary_range']['min_amount']) }} - {{ "{:,}".format(job['salary_range']['max_amount']) }} å††
                        {% else %}
                        å¿œç›¸è«‡
                        {% end %}
                    </td>
                    <td>{{ job['posted_at'][:10] if job['posted_at'] else 'ä¸æ˜' }}</td>
                </tr>
                {% end %}
            </tbody>
        </table>
    </div>

    <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
    {% if total_pages > 1 %}
    <div class="pagination-section">
        <div class="pagination-info">
            {{ (current_page - 1) * 20 + 1 }}ã€œ{{ min(current_page * 20, total_jobs) }}ä»¶ç›®
            ï¼ˆå…¨{{ total_jobs }}ä»¶ä¸­ï¼‰
        </div>

        <div class="pagination">
            {% if has_previous %}
            <a href="?page={{ previous_page }}{% for key, value in filters.items() %}{% if value %}&{{ key }}={{ value }}{% end %}{% end %}"
               class="btn">å‰</a>
            {% else %}
            <button class="btn" disabled>å‰</button>
            {% end %}

            <span class="btn active">{{ current_page }}</span>

            {% if has_next %}
            <a href="?page={{ next_page }}{% for key, value in filters.items() %}{% if value %}&{{ key }}={{ value }}{% end %}{% end %}"
               class="btn">æ¬¡</a>
            {% else %}
            <button class="btn" disabled>æ¬¡</button>
            {% end %}
        </div>
    </div>
    {% end %}

    {% else %}
    <!-- æ¤œç´¢çµæœãªã— -->
    <div class="no-results">
        <div class="no-results-icon">ğŸ”</div>
        <h3>æ¤œç´¢æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹æ±‚äººãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</h3>
        <p>æ¡ä»¶ã‚’å¤‰æ›´ã—ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„</p>
        <a href="/jobs" class="btn btn-primary">ã™ã¹ã¦ã®æ±‚äººã‚’è¡¨ç¤º</a>
    </div>
    {% end %}
</div>
{% end %}

{% block scripts %}
<script>
// æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ã®Enterã‚­ãƒ¼å¯¾å¿œ
document.addEventListener('DOMContentLoaded', function() {
    const searchForm = document.getElementById('search-form');
    const keywordInput = document.getElementById('keyword');

    if (keywordInput) {
        keywordInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchForm.submit();
            }
        });
    }
});
</script>
{% end %}
