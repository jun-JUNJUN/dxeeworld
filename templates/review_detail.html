{% extends "base.html" %}

{% block title %}{{ company_name }}ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼è©³ç´° - Startup Platform: Dxee{% end %}

{% block head %}
<style>
/* Task 4.1: Review Detail Page Styles */
.review-detail-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 20px;
}

/* Breadcrumb Navigation */
.breadcrumb {
    margin-bottom: 20px;
    font-size: 0.9rem;
    color: #6c757d;
}

.breadcrumb a {
    color: #007bff;
    text-decoration: none;
}

.breadcrumb a:hover {
    text-decoration: underline;
}

.breadcrumb-separator {
    margin: 0 8px;
    color: #6c757d;
}

/* Review Header */
.review-header {
    background: white;
    border-radius: 8px;
    padding: 25px;
    margin-bottom: 25px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.review-header h1 {
    font-size: 1.8rem;
    color: #2c3e50;
    margin-bottom: 15px;
}

.company-link {
    color: #007bff;
    text-decoration: none;
    font-weight: 600;
}

.company-link:hover {
    text-decoration: underline;
}

.review-meta {
    display: flex;
    gap: 20px;
    margin-top: 15px;
    flex-wrap: wrap;
    color: #495057;
}

.meta-item {
    display: flex;
    align-items: center;
    gap: 6px;
}

.meta-icon {
    font-size: 1.1rem;
}

/* Rating Summary */
.rating-summary {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 25px;
    text-align: center;
}

.average-rating {
    font-size: 2.5rem;
    font-weight: 700;
    color: #007bff;
    margin-bottom: 10px;
}

.rating-stars {
    font-size: 1.5rem;
    color: #ffc107;
    margin-bottom: 10px;
}

.answered-count {
    color: #6c757d;
    font-size: 0.95rem;
}

/* Category Rating Cards */
.category-ratings {
    display: grid;
    grid-template-columns: 1fr;
    gap: 20px;
    margin-bottom: 25px;
}

.category-card {
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: box-shadow 0.3s ease;
}

.category-card:hover {
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.category-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    flex-wrap: wrap;
    gap: 10px;
}

.category-label {
    font-size: 1.1rem;
    font-weight: 600;
    color: #2c3e50;
}

.category-rating {
    display: flex;
    align-items: center;
    gap: 8px;
}

.rating-stars-small {
    font-size: 1.2rem;
    color: #ffc107;
}

.rating-number {
    font-size: 1.1rem;
    font-weight: 600;
    color: #007bff;
}

.rating-unanswered {
    color: #6c757d;
    font-style: italic;
}

.category-comment {
    color: #495057;
    line-height: 1.6;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 6px;
    border-left: 4px solid #007bff;
}

.comment-masked {
    color: #6c757d;
    font-style: italic;
    text-align: center;
    padding: 15px;
    background: #fff3cd;
    border-radius: 6px;
    border-left: 4px solid #ffc107;
}

.comment-unanswered {
    color: #6c757d;
    font-style: italic;
    text-align: center;
    padding: 15px;
    background: #e9ecef;
    border-radius: 6px;
}

/* Action Buttons */
.action-buttons {
    display: flex;
    gap: 15px;
    margin-top: 30px;
    flex-wrap: wrap;
}

.btn-back,
.btn-reviews {
    padding: 12px 24px;
    border-radius: 6px;
    text-decoration: none;
    font-weight: 500;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.btn-back {
    background: #6c757d;
    color: white;
    border: 2px solid #6c757d;
}

.btn-back:hover {
    background: #5a6268;
    border-color: #5a6268;
    color: white;
}

.btn-reviews {
    background: white;
    color: #007bff;
    border: 2px solid #007bff;
}

.btn-reviews:hover {
    background: #007bff;
    color: white;
}

/* Preview Mode CTA */
.preview-cta {
    background: #fff3cd;
    border: 2px solid #ffc107;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 25px;
    text-align: center;
}

.preview-cta h3 {
    color: #856404;
    font-size: 1.3rem;
    margin-bottom: 10px;
}

.preview-cta p {
    color: #856404;
    margin-bottom: 15px;
}

.btn-submit-review {
    padding: 12px 30px;
    background: #ffc107;
    color: #212529;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    text-decoration: none;
    display: inline-block;
    transition: background 0.3s ease;
}

.btn-submit-review:hover {
    background: #e0a800;
    color: #212529;
}

/* Responsive Design */
@media (min-width: 768px) {
    .category-ratings {
        grid-template-columns: 1fr 1fr;
    }

    .review-header h1 {
        font-size: 2.2rem;
    }

    .average-rating {
        font-size: 3rem;
    }
}

@media (max-width: 767px) {
    .review-detail-container {
        padding: 15px;
    }

    .review-header {
        padding: 20px;
    }

    .review-meta {
        flex-direction: column;
        gap: 10px;
    }

    .category-header {
        flex-direction: column;
        align-items: flex-start;
    }

    .action-buttons {
        flex-direction: column;
    }

    .btn-back,
    .btn-reviews {
        width: 100%;
        justify-content: center;
    }
}
</style>
{% end %}

{% block content %}
<div class="review-detail-container">
    <!-- Breadcrumb Navigation -->
    <nav class="breadcrumb" aria-label="ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆ">
        <a href="/">ãƒ›ãƒ¼ãƒ </a>
        <span class="breadcrumb-separator">â€º</span>
        <a href="/companies">ä¼æ¥­ä¸€è¦§</a>
        <span class="breadcrumb-separator">â€º</span>
        <a href="/companies/{{ company_id }}">{{ company_name }}</a>
        <span class="breadcrumb-separator">â€º</span>
        <span>ãƒ¬ãƒ“ãƒ¥ãƒ¼è©³ç´°</span>
    </nav>

    <!-- Preview Mode CTA (if applicable) -->
    {% if preview_mode %}
    <div class="preview-cta">
        <h3>â„¹ï¸ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰</h3>
        <p>ç¾åœ¨ã€è©•ä¾¡ã‚¹ã‚³ã‚¢ã®ã¿é–²è¦§å¯èƒ½ã§ã™ã€‚ã‚³ãƒ¡ãƒ³ãƒˆè©³ç´°ã‚’è¦‹ã‚‹ã«ã¯ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚</p>
        <a href="/companies/{{ company_id }}/reviews/create" class="btn-submit-review">
            ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æŠ•ç¨¿ã™ã‚‹
        </a>
    </div>
    {% end %}

    <!-- Review Header -->
    <div class="review-header">
        <h1>
            <a href="/companies/{{ company_id }}" class="company-link">{{ company_name }}</a>
            ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼
        </h1>
        <div class="review-meta">
            <div class="meta-item">
                <span class="meta-icon">ğŸ‘¤</span>
                <span>{{ review['anonymized_user'] }}</span>
            </div>
            <div class="meta-item">
                <span class="meta-icon">ğŸ’¼</span>
                <span>{{ review['employment_status'] }}</span>
            </div>
            {% if review.get('employment_period') %}
            <div class="meta-item">
                <span class="meta-icon">ğŸ“…</span>
                <span>
                    {{ review['employment_period']['start_year'] }}å¹´ã€œ{% if review['employment_period'].get('end_year') %}{{ review['employment_period']['end_year'] }}å¹´{% else %}ç¾åœ¨{% end %}
                </span>
            </div>
            {% end %}
            <div class="meta-item">
                <span class="meta-icon">ğŸ“</span>
                <span>{{ review['created_at_jst'].strftime('%Yå¹´%mæœˆ%dæ—¥ %H:%M') }}</span>
            </div>
        </div>
    </div>

    <!-- Rating Summary -->
    <div class="rating-summary">
        <div class="average-rating">{{ "%.1f" % review['individual_average'] }}</div>
        <div class="rating-stars">
            {% set full_stars = int(review['individual_average']) %}
            {% set has_half_star = (review['individual_average'] - full_stars) >= 0.5 %}
            {% for i in range(full_stars) %}â˜…{% end %}{% if has_half_star %}â¯ª{% end %}{% for i in range(5 - full_stars - (1 if has_half_star else 0)) %}â˜†{% end %}
        </div>
        <div class="answered-count">{{ review['answered_count'] }}é …ç›®ã«å›ç­”</div>
    </div>

    <!-- Category Rating Cards -->
    <div class="category-ratings">
        {% for category_key in ['recommendation', 'foreign_support', 'company_culture', 'employee_relations', 'evaluation_system', 'promotion_treatment'] %}
        <div class="category-card">
            <div class="category-header">
                <div class="category-label">{{ category_labels[category_key] }}</div>
                <div class="category-rating">
                    {% set rating = review['ratings'].get(category_key) %}
                    {% if rating is not None %}
                        <span class="rating-stars-small">
                            {% for i in range(rating) %}â˜…{% end %}{% for i in range(5 - rating) %}â˜†{% end %}
                        </span>
                        <span class="rating-number">{{ rating }}</span>
                    {% else %}
                        <span class="rating-unanswered">æœªå›ç­”</span>
                    {% end %}
                </div>
            </div>

            {% set comment = review['comments'].get(category_key) %}
            {% if rating is None %}
                <div class="comment-unanswered">
                    ã“ã®é …ç›®ã¯å›ç­”ã•ã‚Œã¦ã„ã¾ã›ã‚“
                </div>
            {% elif preview_mode %}
                <div class="comment-masked">
                    *** ã“ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¦‹ã‚‹ã«ã¯ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æŠ•ç¨¿ã—ã¦ãã ã•ã„ ***
                </div>
            {% elif comment %}
                <div class="category-comment">
                    {{ comment }}
                </div>
            {% else %}
                <div class="comment-unanswered">
                    ã‚³ãƒ¡ãƒ³ãƒˆãªã—
                </div>
            {% end %}
        </div>
        {% end %}
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
        <a href="/companies/{{ company_id }}" class="btn-back">
            <span>â†</span>
            <span>ä¼æ¥­ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</span>
        </a>
        <a href="/companies/{{ company_id }}" class="btn-reviews">
            <span>ğŸ“‹</span>
            <span>ä»–ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¦‹ã‚‹</span>
        </a>
    </div>
</div>
{% end %}
